function getUrlParams(){var t=location.search,e=new Object;if(-1!=t.indexOf("?"))for(var n=t.substr(1),i=n.split("&"),a=0;a<i.length;a++)e[i[a].split("=")[0]]=i[a].split("=")[1];return e}function addCookie(t,e,n){console.log("[Cookie]Add:"+t+","+e+","+n);var i=t+"="+escape(e);if(n>0){var a=new Date;a.setTime(a.getTime()+3600*n*1e3),i=i+"; expires="+a.toGMTString()}document.cookie=i}function getCookie(t){for(var e=document.cookie,n=e.split("; "),i=0;i<n.length;i++){var a=n[i].split("=");if(a[0]==t)return unescape(a[1])}return""}function $node(t){return document.getElementById(t)}function $listen(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent(e,n)}function $unlisten(t,e,n){t.removeEventListener?t.removeEventListener(e,n):t.detachEvent&&t.detachEvent(e,n)}function calcImgClip(t,e,n,i){var a,o,s,r;return n/i>t/e?(o=e,a=Math.floor(e*(n/i))):(a=t,o=Math.floor(t*(i/n))),s=(a-t)/2,r=(o-e)/2,{objWidth:a,objHeight:o,clipLeft:s,clipTop:r}}function checkOpenId(){var t="uid";if(""!=getCookie(t))console.log("Openid use cookie");else{var e=getUrlParams(),n=e.openid;if(void 0==n){console.log("openid is not exist, redirect");var i=location.href;i=i.replace(/\./g,"_d_"),i=i.replace(/\:/g,"_mh_"),i=i.replace(/\//g,"_xg_"),i=i.replace(/\?/g,"_wh_"),i=i.replace(/\&/g,"_y_"),i=i.replace(/\=/g,"_dh_");var a="wx1f77672efbc50503",o="http://wxauth.kagirl.net/wx/callback_ttxuanpai.php";o=o+"?back_url="+i,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+a+"&redirect_uri="+encodeURIComponent(o)+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"}else console.log("Get redirect openid:"+n),addCookie(t,n,72)}}function getUID(){var t=getCookie("uid");if(""==t){var e=getUserInfo();null!=e&&(t=e.openid)}return t}function getUserInfo(){try{var t=getCookie("ttxp_userinfo");return""==t?null:JSON.parse(t)}catch(e){return console.log("exception when getUserInfo,msg:"+e.message+", desc:"+e.description),null}}function checkWxUserInfo(){var t="ttxp_userinfo";if(""!=getCookie(t))console.log("User info use cookie");else{var e=getUrlParams(),n=e.openid;if(void 0==n){console.log("openid is not exist, redirect");var i=location.href;i=i.replace(/\./g,"_d_"),i=i.replace(/\:/g,"_mh_"),i=i.replace(/\//g,"_xg_"),i=i.replace(/\?/g,"_wh_"),i=i.replace(/\&/g,"_y_"),i=i.replace(/\=/g,"_dh_");var a="wx1f77672efbc50503",o="http://wxauth.kagirl.net/wx/userinfo_ttxp.php";o=o+"?back_url="+i,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+a+"&redirect_uri="+encodeURIComponent(o)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"}else{console.log("Get redirect info:"+n),addCookie("uid",n,72);var s={openid:n,headimgurl:decodeURIComponent(e.headimgurl),nickname:decodeURIComponent(e.nickname),sex:e.sex};addCookie(t,JSON.stringify(s),72)}}}function hasClass(t,e){return t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}function addClass(t,e){hasClass(t,e)||(t.className+=" "+e)}function removeClass(t,e){if(hasClass(t,e)){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n,"")}}function QOS_Report(t,e){console.log("reportData, type:"+t+", value:"+e),$.ajax({type:"POST",url:"http://qos.ttxuanpai.com/data/report",data:JSON.stringify({type:t,data:{value:e}}),dataType:"json"})}function QOS_Error(t){QOS_Report("ERROR",t)}function QOS_Err(t,e){QOS_Report("ERR",{code:t,context:e})}function QOS_Stat(t,e){QOS_Report("STAT",{name:t,time:e})}function $transform(t,e){t.style.transform=t.style["-webkit-transform"]=t.style["-ms-transform"]=e}function is_iOS(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)?!0:!1}function ttxp_effect_meteor(t,e,n){var i=document.createElement("img");i.className="ttxp_effect_meteor",i.src="http://cdn.ttxuanpai.com/album_template/effect/images/meteor.png",$(i).width(104).height(33).css("left",e+"px").css("top",n+"px").css("opacity",.7);var a=90*Math.random(),o=0,s=.8*Math.random()+.2,r="rotate("+a+"deg) translate3d(0,0,"+o+"px)scale3d("+s+","+s+","+s+")";$transform(i,r);var c=parseInt(1+3*Math.random());$(i).css("webkitAnimationDelay",c+"s").css("animationDelay",c+"s"),t.appendChild(i),window.setTimeout(function(){i.style.display="block"},5e3*Math.random())}function ttxp_effect_snow(t,e,n){var i=document.createElement("div");i.className="ttxp_effect_snow",i.innerHTML="<img>";var a=$(i).find("img");a[0].src="http://cdn.ttxuanpai.com/album_template/effect/images/snow_"+(1+Math.floor(4*Math.random()))+".png",$(i).width(42).height(44).css("left",Math.random()*e+"px").css("top","-100px"),a.css("opacity",.9).width(42).height(44),i.style.webkitAnimationName="kf_ttxp_snow_fade, kf_ttxp_snow_drop";var o=Math.random()<.5?"kf_ttxp_snow_clockwiseSpin":"kf_ttxp_snow_counterclockwiseSpinAndFlip";a.css("-webkit-animation-name",o).css("animation-name",o);var s=function(t,e){return t+Math.random()*(e-t)},r=s(10,15)+"s",c=s(4,8)+"s";i.style.webkitAnimationDuration=r+", "+r;var l=s(0,15)+"s";i.style.webkitAnimationDelay=l+", "+l,a[0].style.webkitAnimationDuration=c,t.appendChild(i)}function TTXP_Create_Effect_Snow(t,e,n){new ttxp_effect_snow(t,e,n)}function ttxp_effect_star(t,e,n){var i=document.createElement("img");i.className="ttxp_effect_star",i.src="http://cdn.ttxuanpai.com/album_template/effect/images/star.png",$(i).width(21).height(22).css("left",e+"px").css("top",n+"px").css("opacity",.7);var a=90*Math.random(),o=0,s=.8*Math.random()+.2,r="rotate("+a+"deg) translate3d(0,0,"+o+"px)scale3d("+s+","+s+","+s+")";$transform(i,r);var c=parseInt(5+5*Math.random());$(i).css("webkitAnimationDuration",c+"s").css("animationDuration",c+"s"),t.appendChild(i),window.setTimeout(function(){i.style.display="block"},5e3*Math.random())}function wxImgUploader(){var t=[],e=0,n=!1;this.pushTask=function(a,o){var s={localId:a,callback:o,id:e++};console.log("add upload task #"+s.id),t.push(s),0==n&&i()};var i=function(){t.length>0&&(n=!0,window.setTimeout(function(){o(t.pop())},100))},a=function(t,e,a){console.log("end upload task #"+e.id+", ret:"+t+", serverId:"+a),n=!1,e.callback(t,e.localId,a),i()},o=function(t){console.log("begin upload task #"+t.id+", id:"+t.localId),wx.uploadImage({localId:t.localId,isShowProgressTips:0,success:function(e){a(!0,t,e.serverId)},fail:function(){a(!1,t,"")},complete:function(){console.log("[wx]upload image complete #",t.id)}})}}TTXP_Animation_Mgr=new function(){function t(t){var r=$(this).data(e),c=o(this),l=c>-1?a[c]:null,d=l&&l.param[n],p=l&&l.param[i];if(d&&d(this,t.animationName),t.animationName==r)p&&p(this);else{var f=l.param.animates[++a[c].frame];s(this,f)}}var e="animation-mgr-last-animation-name",n="progress",i="end",a=[],o=function(t){for(var e=0;e<a.length;++e)if(a[e].obj==t)return e;return-1};this.animate=function(n,i){if(i&&i.animates&&!(i.animates.length<1)){$(n).data(e,i.animates[i.animates.length-1].name);var r=o(n);r>-1?(a[r].param=i,a[r].frame=0):a.push({obj:n,frame:0,param:i}),s(n,i.animates[0]),$listen(n,"webkitAnimationEnd",t),$listen(n,"animationEnd",t)}};var s=function(t,e){e&&t&&window.setTimeout(function(){var n=e.name,i=e.duration+"s",a=e.timing,o=e.count;$(t).css("animation-name",n).css("-webkit-animation-name",n).css("animation-duration",i).css("-webkit-animation-duration",i).css("animation-delay","").css("-webkit-animation-delay","0").css("animation-timing-function",a).css("-webkit-animation-timing-function",a).css("animation-iteration-count",o).css("-webkit-animation-iteration-count",o)},1e3*("undefined"!=e.delay?e.delay:0))}};var TTXP_DA=new function(){this.click=function(t){try{MtaH5.clickStat(t)}catch(e){}}},TTXP_UI=new function(){this.MessageBox=new function(){var t="ttxp_msg_box_ok_cancel";this.show=function(e){var n='<div class="ttxp_messagebox_content">                    <div class="ttxp_messagebox_title"><strong>弹窗标题</strong></div>                    <div class="ttxp_messagebox_info">自定义弹窗内容<br></div>                    <div class="ttxp_messagebox_ft">                        <a href="javascript:;" class="ttxp_msg_box_btn_cancel">取消</a>                        <a href="javascript:;" class="ttxp_msg_box_btn_ok">确定</a>                    </div>                </div>',i=$("#"+t);if(!i.length){var a=document.createElement("div");$(a).addClass("ttxp_messagebox").css("display","none").css("z-index",99999).css("position","absolute").attr("id",t).html(n),$("body").append(a),i=$("#"+t)}e&&null!=e.title&&void 0!=e.title&&i.find(".ttxp_messagebox_title strong").text(e.title),e&&e.message&&i.find(".ttxp_messagebox_info").html(e.message),i.find(".ttxp_msg_box_btn_ok").on("click",function(){e&&e.ok&&e.ok(),i.hide(),i.remove()}),i.find(".ttxp_msg_box_btn_cancel").on("click",function(){e&&e.cancel&&e.cancel(),i.hide(),i.remove()}),i.show()},this.hide=function(){var e=$("#"+t);e.length&&(e.hide(),e.remove())}},this.LoadingToast=new function(){var t="ttxp_loading_toast";this.show=function(e){var n='                <div class="ttxp-toast-mask"></div>                <div class="ttxp-toast">                    <div class="ttxp-toast-loading">                        <div><span></span></div>                        <div><span></span></div>                        <div><span></span></div>                    </div>                    <p class="ttxp-toast-content">数据加载中</p>                </div>            ',i=$("#"+t);if(!i.length){var a=document.createElement("div");$(a).css("display","none").css("z-index",99999).css("position","absolute").attr("id",t).html(n),$("body").append(a),i=$("#"+t)}e&&i.find(".ttxp-toast-content").text(e),i.show()},this.hide=function(){var e=$("#"+t);e.length&&(e.hide(),e.remove())},this.setText=function(e){if(e){var n=$("#"+t);n.length&&n.find(".myui_toast_content").text(e)}}}};$listen(document,"DOMContentLoaded",function(){console.log("DOMContentLoaded");try{var t=window.location.href,e=[];e=t.split("/");var n=e[e.length-1];e=n.split("?");var i=new Date,a=i.getTime()-__time_begin.getTime();QOS_Stat("DOMLoaded_"+e[0],a)}catch(o){console.log("Exception when DOMContentLoaded")}});var LOG=new function(){this.trace=function(t,e){this.info(t,e)},this.info=function(e,n){t("T",e,n)},this.warn=function(e,n){t("W",e,n)},this.error=function(e,n){t("E",e,n)};var t=function(t,e,n){try{console.log("["+t+"]["+(e||"")+"]"+(n||""))}catch(i){}}},wxAPI=new function(){var t="wxAPI",e=null;this.init=function(e,n,i,a){var o=this;this.isWx()?this._realInit(e,function(s){s?n(!0):(LOG.warn(t,"init fail! try again"),o._realInit(e,function(t){n(t),t?QOS_Stat("wxAPI_Fail2Success",0):QOS_Stat("wxAPI_Fail2Fail",0)},i,a,5e3))},i,a,6e4):(LOG.info(t,"Page is not in wechat"),QOS_Stat("PageNotInWechat",0),n(!1))},this._realInit=function(e,n,i,a,o){LOG.info(t,"req init wx api");var s=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","onMenuShareWeibo","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","chooseImage","uploadImage"],r=!1,c=function(t){return 1==r?!1:(r=!0,n(t),!0)},l=function(n,i,a,r){LOG.info(t,"req __init_wx_api");try{wx.config({debug:e,appId:n,timestamp:i,nonceStr:a,signature:r,jsApiList:s}),LOG.info(t,"finished wx.config"),window.setTimeout(function(){c(!1)&&(LOG.info(t,"wx config timeout"),QOS_Error("InitWxApiTimeout"))},o)}catch(l){LOG.error(t,"exception when wx.config:"+l.description)}};if(QOS_Stat("PageInWechat",0),a)if("0"==a.ret){LOG.info(t,"get jsapi, req wx config");var d=a.data;l(d.appId,d.timestamp,d.noncestr,d.signature)}else c(!1),QOS_Error("ReqJsApiFail");else $.ajax({type:"POST",url:"http://api.ttxuanpai.com/cgi-bin/get_jsapi_signature",data:JSON.stringify({url:location.href.split("#")[0]}),success:function(e,n){if(LOG.info(t,"res get_jsapi:"+JSON.stringify(e)),"0"==e.ret){LOG.info(t,"get jsapi, req wx config");var i=e.data;l(i.appId,i.timestamp,i.noncestr,i.signature)}else LOG.info(t,"request jsapi failed, status:"+n),c(!1),QOS_Error("ReqJsApiFail")},fail:function(){LOG.error(t,"request jsapi failed, status:"+status),c(!1),QOS_Error("ReqJsApiFail")},dataType:"json"});wx.ready(function(){LOG.info(t,"wx ready"),c(!0)}),wx.error(function(e){LOG.error(t,"wx onerror, res:"+JSON.stringify(e)),c(!1),QOS_Error("WxError")})},this.downloadImage=function(t,e){LOG.error("do not support downloadImage")},this.uploadImage=function(t,n){null==e&&(e=new wxImgUploader),e.pushTask(t,n)},this.isWx=function(){var t=navigator.userAgent.toLowerCase();return"micromessenger"==t.match(/MicroMessenger/i)}},TTXP_Image=new function(){this.loadImage=function(t){var e=new Image;e.onload=function(){t&&t.success&&t.success(this)},e.onerror=function(){t&&t.fail&&t.fail(this)},e.src=t.url},this.clip=function(t,e,n,i,a){var o,s,r,c;i/a>e/n?(s=n,o=Math.floor(n*(i/a))):(o=e,s=Math.floor(e*(a/i))),r=(o-e)/2,c=(s-n)/2,$(t).width(o).height(s).css("left",0-r+"px").css("top",0-c+"px"),t.style.clip="rect("+c+"px "+Math.floor(r+e)+"px "+Math.floor(c+n)+"px "+r+"px)"}};